设定rule：
判断所属系统类型，并根据系统做相应优化
生成一个prompt.md 文件，递增记录用胡每次输入的原始指令，每轮对话需要浏览用户的指令记录，并记录已完成的项，理解用户意图和需求，避免多轮对话出现幻觉和失去焦点
在对话开始，通过 3 轮与用户的对话，了解用户意图，并根据意图写一个任务文件，命名为 task.md，并在该文件中写入任务主线，并在以后每个对话中不断丰富，小分支则并入主线下，以缩进作为区分。对该文件的修改，每次都只能在次基础上新增，如果已经完成则在行首标记#+已完成，用户提出的对原有任务的修改则在行首标记#-作废，并在下一行添加修改后的任务。也就是只能增，不能删，最大程度保留用户的思维链
注意：每次对话，prompt 文件和 task 文件都需要按要求更新
每轮都应遵循以下方式，对关键问题进行简要报告：你要干什么，为什么这么干，有什么预期，当完成后简要汇报结果


原始指令：
0001
为我开发这样的一个软件，多ai协同写作，多版本 git，写作流程：用户输入内容，包括主题或者其他关键信息，或者图片 pdf 等文件，调用 kimi-k2-0711-preview 模型进行评估用户的写作意图，调用多 ai 给出写作大纲（国内外至少 3 个，国内 kimi、qwen、glm4.5，DeepSeek，国外最好的三个，注意这里可以多选机制，让用户自己选择模型并配置），调用Qwen 进行合并大纲，多 ai 领取大纲中的一条进行编写，Qwen 合并汇编，评估主题内容，多 ai模拟该领域的专家人物进行提问点评， 并进行修改，git 呈现修改。最后 Qwen 合并终稿，kimi联网模式进行核验内容真实性，修正。并调用语音 api 朗读，整个过程，就好像 vscode 界面一样，在中间呈现整个过程和多方来源动作，另外弄一个设置页面，在页面内进行配置各个模型的 api 等信息，按照流程来让用户选择模型，和可编辑提示词框，以便用户优化提示词，请你对这个过程进行评估优化，使用最佳实践方案

0002
根据你的建议，为我进行，不要管我有没有 key，因为这些都可以实现

0002
次给你我的要求，同时注意，每一步的提示词应该可编辑展示，让用户进一步修改。原始要求：为我开发这样的一个软件，多ai协同写作，多版本 git，写作流程：用户输入内容，包括主题或者其他关键信息，或者图片 pdf 等文件，调用 kimi-k2-0711-preview 模型进行评估用户的写作意图，调用多 ai 给出写作大纲（国内外至少 3 个，国内 kimi、qwen、glm4.5，DeepSeek，国外最好的三个，注意这里可以多选机制，让用户自己选择模型并配置），调用Qwen 进行合并大纲，多 ai 领取大纲中的一条进行编写，Qwen 合并汇编，评估主题内容，多 ai模拟该领域的专家人物进行提问点评， 并进行修改，git 呈现修改。最后 Qwen 合并终稿，kimi联网模式进行核验内容真实性，修正。并调用语音 api 朗读，整个过程，就好像 vscode 界面一样，在中间呈现整个过程和多方来源动作，另外弄一个设置页面，在页面内进行配置各个模型的 api 等信息，按照流程来让用户选择模型，和可编辑提示词框，以便用户优化提示词，请你对这个过程进行评估优化，使用最佳实践方案
在现有基础上实现我的所有要求，

0004
在你生成的都是虚假的占位，没有任何实际运行输出。- 配置中加入按阶段选择模型（UI 与接口支持）
- 右侧“提示词编辑器”（每阶段可编辑保存）
- 逐 token 实时输出（更细颗粒的流式体验）
- 左侧文件上传（PDF/图片占位解析注入上下文）全部实现，另外增加可灵的 api 接口，增加一个环节，在最后生成的终稿基础上，每段配图一张，放在对应段落下方，调用可灵 api 实现，提示词用所用文本段落进行优化：调用 kimi2 的 api，用提示词：对该段落【段落内容】生成图片生成的提示词，返回提示词直接用于图像生成，生成完成后回调到终稿插入，另外除了可灵，还应接入可选的拍我、即梦、nano banana 等模型 api 的可选

0005
阶段模型选择区域根本没有看到图像生成部分，也没有实现图像返回到终稿中去
image-generation下的模型选项是错的，提供的不是图片供应商模型

0006
图片生成依然出错，不知道是没生成还没没有回调到文档对应位置。引用来源应该点击就能取到原文，还有终稿版面没有统一格式。Console Error
An empty string ("") was passed to the src attribute. This may cause the browser to download the whole page again over the network. To fix this, either do not render the element at all or pass null to src instead of an empty string.
app/page.tsx (406:3) @ Home
404 |             )}
405 |             <div className="prose prose-sm max-w-none bg-white border p-3 rounded shadow-inner">
> 406 |   <ReactMarkdown>{finalMd}</ReactMarkdown>
|   ^
407 | </div>
408 |           </div>
409 |         </div>
Call Stack
29
Show 27 ignore-listed frame(s)
img
<anonymous>
Home
app/page.tsx (406:3)